# Daily portfolio data

在计算日频组合收益率时，遇到了许多问题。因为没有日频的特征数据，所以只能构建月频策略，计算月频策略的日频收益率。具体来说，就是仍然在每个月月底构建 managed portfolio，组合权重在下一个月保持不变。

思路很简单，就是通过 reindex，将月频数据的 month date 转换为日频的 day date ，并对其中每一个 permno 进行 groupby 并后向填充，这样就可以得到日频的特征数据。但是在这个过程中，遇到了许多问题。

1. 月频日期数据和日频日期数据不对应。月频数据的日期都是每个月的最后一天， 而日频数据是每个月的最后一个交易日，这样 reindex 后会丢失许多月频数据。所以要想办法把月频收益率的日期数据对应到日频上去。


2. 月频 permno 数据和日频 permno 数据不对应。月频特征数据包含了一些计算规则，例如刚上市几天的数据并没有算进来，所以日频的 permno 是比月频要多的，即使以月频的 permno 为准，这些 month permno 也不是在每一天都有数据的。也就是说，即使在 day permno 中扔掉了 month permno 不包含的股票，每一天的 permno 有时仍然会有微小的差别，例如差个一两只这样。

最终以月频数据为主，对日期进行补全后，利用 np.tile 数据在每一个日期上进行数据复制。至于收益率则以日频为准，利用延拓后的月频 dataframe reindex 日频 dataframe，将缺失值填充为0.

3. 数据量过大，每次算着算着 kernel 就 die 了。将数据分段，处理后再放到一起。

不过即使在变为日频这一步没有发生问题，在接下来的 normalize 跑了 40 分钟也 die 了。数据量太大了。


